import{Component as t,options as i,isValidElement as e,Fragment as n}from"preact";import{useMemo as o,useRef as f,useEffect as r}from"preact/hooks";import{effect as s,Signal as u,computed as c,signal as l,batch as a}from"@preact/signals-core";export{Signal,action,batch,computed,createModel,effect,signal,untracked}from"@preact/signals-core";const d="undefined"!=typeof window&&!!window.__PREACT_SIGNALS_DEVTOOLS__;let h,p,m,v=[],_=[];s(function(){h=this.N})();function g(t,e){i[t]=e.bind(null,i[t]||(()=>{}))}function b(t){if(m){const t=m;m=void 0;t()}m=t&&t.S()}function y({data:t}){const i=useSignal(t);i.value=t;const[n,f]=o(()=>{let t=this,n=this.__v;while(n=n.__)if(n.__c){n.__c.__$f|=4;break}const o=c(()=>{let t=i.value.value;return 0===t?0:!0===t?"":t||""}),f=c(()=>!Array.isArray(o.value)&&!e(o.value)),r=s(function(){this.N=F;if(f.value){const i=o.value;if(t.__v&&t.__v.__e&&3===t.__v.__e.nodeType)t.__v.__e.data=i}}),u=this.__$u.d;this.__$u.d=function(){r();u.call(this)};return[f,o]},[]);return n.value?f.peek():f.value}y.displayName="ReactiveTextNode";Object.defineProperties(u.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:y},props:{configurable:!0,get(){return{data:this}}},__b:{configurable:!0,value:1}});g("__b",(t,i)=>{if("string"==typeof i.type){let t,e=i.props;for(let n in e){if("children"===n)continue;let o=e[n];if(o instanceof u){if(!t)i.__np=t={};t[n]=o;e[n]=o.peek()}}}t(i)});g("__r",(t,i)=>{t(i);if(i.type!==n){b();let t,e=i.__c;if(e){e.__$f&=-2;t=e.__$u;if(void 0===t)e.__$u=t=function(t,i){let e;s(function(){e=this},{name:i});e.c=t;return e}(()=>{var i;if(d)null==(i=t.y)||i.call(t);e.__$f|=1;e.setState({})},"function"==typeof i.type?i.type.displayName||i.type.name:"")}p=e;b(t)}});g("__e",(t,i,e,n)=>{b();p=void 0;t(i,e,n)});g("diffed",(t,i)=>{b();p=void 0;let e;if("string"==typeof i.type&&(e=i.__e)){let t=i.__np,n=i.props;if(t){let i=e.U;if(i)for(let e in i){let n=i[e];if(void 0!==n&&!(e in t)){n.d();i[e]=void 0}}else{i={};e.U=i}for(let o in t){let f=i[o],r=t[o];if(void 0===f){f=w(e,o,r);i[o]=f}else f.o(r,n)}for(let i in t)n[i]=t[i]}}t(i)});function w(t,i,e,n){const o=i in t&&void 0===t.ownerSVGElement,f=l(e);let r=e.peek();return{o:(t,i)=>{f.value=t;r=t.peek()},d:s(function(){this.N=F;const e=f.value.value;if(r!==e){r=void 0;if(o)t[i]=e;else if(null!=e&&(!1!==e||"-"===i[4]))t.setAttribute(i,e);else t.removeAttribute(i)}else r=void 0})}}g("unmount",(t,i)=>{if("string"==typeof i.type){let t=i.__e;if(t){const i=t.U;if(i){t.U=void 0;for(let t in i){let e=i[t];if(e)e.d()}}}i.__np=void 0}else{let t=i.__c;if(t){const i=t.__$u;if(i){t.__$u=void 0;i.d()}}}t(i)});g("__h",(t,i,e,n)=>{if(n<3||9===n)i.__$f|=2;t(i,e,n)});t.prototype.shouldComponentUpdate=function(t,i){if(this.__R)return!0;const e=this.__$u,n=e&&void 0!==e.s;for(let t in i)return!0;if(this.__f||"boolean"==typeof this.u&&!0===this.u){const t=2&this.__$f;if(!(n||t||4&this.__$f))return!0;if(1&this.__$f)return!0}else{if(!(n||4&this.__$f))return!0;if(3&this.__$f)return!0}for(let i in t)if("__source"!==i&&t[i]!==this.props[i])return!0;for(let i in this.props)if(!(i in t))return!0;return!1};function useSignal(t,i){return o(()=>l(t,i),[])}function useComputed(t,i){const e=f(t);e.current=t;p.__$f|=4;return o(()=>c(()=>e.current(),i),[])}const k="undefined"==typeof requestAnimationFrame?setTimeout:function(t){const i=()=>{clearTimeout(e);cancelAnimationFrame(n);t()},e=setTimeout(i,35),n=requestAnimationFrame(i)},q=t=>{queueMicrotask(()=>{queueMicrotask(t)})};function A(){a(()=>{let t;while(t=v.shift())h.call(t)})}function T(){if(1===v.push(this))(i.requestAnimationFrame||k)(A)}function x(){a(()=>{let t;while(t=_.shift())h.call(t)})}function F(){if(1===_.push(this))(i.requestAnimationFrame||q)(x)}function useSignalEffect(t,i){const e=f(t);e.current=t;r(()=>s(function(){this.N=T;return e.current()},i),[])}function M(t){const i=o(()=>t(),[]);r(()=>i[Symbol.dispose],[i]);return i}export{useComputed,M as useModel,useSignal,useSignalEffect};//# sourceMappingURL=signals.mjs.map
